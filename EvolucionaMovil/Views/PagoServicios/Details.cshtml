@model EvolucionaMovil.Models.PagoVM
@using EvolucionaMovil.Models.Enums;
@{
    ViewBag.Title = "Detalle de pago";
}
<h2>
    Detalle de pago</h2>
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)
    <fieldset>
        <div class="display-label">
            Nombre Cliente
        </div>
        <div class="display-field">
            @Html.DisplayFor(model => model.ClienteNombre)
        </div>
        <div class="display-label">
            Estatus
        </div>
        <div class="display-field">
            @Html.DisplayFor(model => model.Estatus)
        </div>
        <div class="display-label">
            Fecha creación
        </div>
        <div class="display-field">
            @Html.DisplayFor(model => model.FechaCreacion)
        </div>
        <div class="display-label">
            Fecha vencimiento
        </div>
        <div class="display-field">
            @Html.DisplayFor(model => model.FechaVencimiento)
        </div>
        <div class="display-label">
            Importe
        </div>
        <div class="display-field">
            @Html.DisplayFor(model => model.Importe)
        </div>
        <div class="display-label">
            Servicio
        </div>
        <div class="display-field">
            @Html.DisplayFor(model => model.ServicioNombre)
        </div>
        @Html.HiddenFor(model => model.PagoId)
        @Html.HiddenFor(model => model.ServicioId)
        @Html.HiddenFor(model => model.PayCenterId)
        @Html.HiddenFor(model => model.CambioEstatusVM.Estatus)
        <div id="DetallesServicio">
            <div class="listHeader">
                Detalle de servicio</div>
            @if (Model.DetallePagos != null)
            {
                foreach (var item in Model.DetallePagos)
                { 
                <div class="listRow">
                    <span class="listCell fwb">@item.Campo </span><span class="listCell">@item.Valor
                    </span>
                </div> 
                }
            }
        </div>
        <hr />
        <div id="HistoricoMovimientos">
            <div class="listHeader">
                <a id="desgloseHistorial" href="javascript:toggle();">Historico Movimientos</a>
            </div>
            <div id="lsHistorial" style="display: none">
                @if (Model.DetallePagos != null)
                {
                    foreach (var item in Model.HistorialEstatusVM)
                    { 
                    <div class="listRow">
                        <span class="listCell Estatus @item.Estatus fwb">@item.Estatus </span><span class="listCell Comentarios">
                            @item.Comentarios </span><span class="listCell Usuario">@item.UserName</span>
                        <span class="listCell Fecha">@item.Fecha</span>
                    </div> 
                    }
                }</div>
        </div>
        <hr />
        <div class="edidor-label">
            Comentario
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.CambioEstatusVM.Comentario)
        </div>
        <hr />
        <a href="..\Ticket\@Model.PagoId.ToString()" >Ver ticket</a>
        <div id="botones">
            @if (@Model.Status != enumEstatusMovimiento.Cancelado.GetHashCode())
            {
                if (ViewBag.Role == enumRoles.PayCenter.GetHashCode())
                {
                <input type="button" id="Cancelar"  onclick="asignaStatus('@enumEstatusMovimiento.Cancelado')" name="action" class="freshbutton-blue" value="Cancelar" />
                }
                else if (ViewBag.Role == enumRoles.Staff.GetHashCode() || ViewBag.Role == enumRoles.Administrator.GetHashCode())
                {
                <div>
                    @if (@Model.Status != enumEstatusMovimiento.Aplicado.GetHashCode())
                    {
                        <input type="button" id="Aplicar" onclick="asignaStatus('@enumEstatusMovimiento.Aplicado')" name="CambioEstatusVM.Estatus"
                            class="freshbutton-blue" value="Aplicar" /> 
                    }
                    @if (@Model.Status != enumEstatusMovimiento.Rechazado.GetHashCode())
                    {
                        <input type="button" id = "Rechazar" onclick="asignaStatus('@enumEstatusMovimiento.Rechazado')" class="freshbutton-blue" value="Rechazar" /> 
                    }
                </div>
                }
            }
            <input type="submit" id="btnEnviar" style="display: none" />
        </div>
        <div>
            <p>@ViewBag.Mensaje</p>
        </div>
    </fieldset>
}
<div>
    @Html.ActionLink("Back to List", "Index")
</div>
<script type="text/javascript">
    function asignaStatus(status) {
        $("#CambioEstatusVM_Estatus").val(status);
        $("#btnEnviar").click();
    }
    function toggle() {
        var options = {};
        $("#lsHistorial").toggle("blind", options, 500);
    }
</script>
